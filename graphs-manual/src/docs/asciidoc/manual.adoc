:toc:
:sourcedir: ../../../src/test/java

= Graphs

== Usage

`Graphs` is written in java 11 and is made up of a few modules published to maven central.

`graphs-core` contains the main interfaces, implementations, and events

----
compile group: 'com.github.moaxcp.graphs', name: 'graphs-core', version: '0.8.0'
----

`graphs-greenrobot` EventGraph implementation using greenrobot's EventBus

----
compile group: 'com.github.moaxcp.graphs', name: 'graphs-greenrobot', version: '0.8.0'
----

`graphs-graphviz` rendering for graphviz

----
compile group: 'com.github.moaxcp.graphs', name: 'graphs-graphviz', version: '0.8.0'
----

`graphs-truth` assertions using google-truth

----
compile group: 'com.github.moaxcp.graphs', name: 'graphs-truth', version: '0.8.0'
----


== What is a graph

A graph is a data structure containing a set of vertices and a set of edges. A vertex is typically a value and an edge
is a relationship between two vertices (or values). The graph may be directed or undirected. The `Graph`
interface provides a dsl for declaring vertices, edges and properties. It is the main interface for representing a
graph. Values are represented as properties of a `Graph`, `Vertex`, or `Edge`. Some properties are required some are
optional. The rest of the guide will walk through some of the key concepts of the library.

== Representing a graph as code

The `Graph` interface defines methods for building a graph as well as inner classes `Vertex` and `Edge`. These Inner
classes provide a perspective of the graph from those elements. Edges can change their endpoints, navigate to an
endpoint and modify properties. Vertices can add new edges, get in, out, and adjacent edges, and modify properties.

There are two implementations of `Graph` in the `graphs-core` module.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=graphsCore]
----

There are two other implementations of `Graph` in the 'graphs-greenrobot` module.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=graphsGreenrobot]
----

These implementations send events to subscribers to the EventBus when the graph changes.

=== Create or modify a vertex

To create or modify a vertex use the `vertex` or `getVertex` methods.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=vertex]
----

`vertex` methods will return the graph while `getVertex` methods will return the vertex. This allows for different
forms of method chaining.

If a vertex already exists in the graph it can be modified.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=modifyVertex]
----

The first call to `vertex` creates vertex `A` with a property `color` set to `red`. The second call changes the property `color` to `blue`.

If graph is an `EventGraph` events will be sent to the `EventBus`. Every modification of a graph is represented by an
event.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=modifyVertexEvents]
----

In this case a `VertexCreatedEvent` is sent to the `EventBus`.

=== Create or modify an edge

To create or modify an edge use the `edge` or `getEdge` methods.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=edge]
----

If an edge already exits in the graph it can be modified.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=modifyEdge]
----

The first call to `edge` creates edge `A -> B` with property `color` set to `red`. The second call changes the property
`color` to `green`.

If the graph is an `EventGraph` events will be sent to the `EventBus`.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=modifyEdgeEvents]
----

First a `VertexCreatedEvent` for vertex `A` is sent to the `EventBus`. Followed by a `VertexCreatedEvent` for vertex
`B` and an `EdgeCreatedEvent` for the edge between them.

=== properties

Vertices must have an `id` property which is unique to all vertices in the `Graph`.

Edges must have a `from` property which represents the `Vertex` the `Edge` connects from (or source vertex) and a `to`
property which represents the `Vertex` the `Edge` connects to (the target vertex). Edges may have an optional `id`
property.

Graphs may have an optional `id`.

Graphs, vertices, and edges can have other properties added to them. These properties can be used to represent
anything. For instance, if the graph needs to be represented in graphviz there can be properties for color and style.

The `Graph` interface is used to represent a property graph.

=== inherited properties

Vertices and edges in a graph can inherit properties from common vertex properties and edge properties setup in the
graph.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/RepresentingAGraphAsCode.java[tags=inheritedProperties]
----

The default color for all vertices and edges is set to `"green"` and `"red"` respectively.

== Create a graph using edge methods

A graph can be constructed by calling edge methods. The vertices declared in the calls are implicitly created.


[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/EdgeMethods.java[tags=edge]
----

Edge methods will create vertices and can also add properties to the edge.

The properties can be anything but here they are used for graphviz.


[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/EdgeMethods.java[tags=dot]
----

image::images/edgeMethods.png[edge classification]

`edge` methods return the graph and can be chained to add multiple edges. If an `Edge` instance is needed use `getEdge`
instead. `getEdge` return the Edge so it can modified. This allows properties to be added, removed, or updated
including the "to" and "from" vertices of the edge. `getEdge` can also be used to declare properties on the edge.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/EdgeMethods.java[tags=getEdge]
----

The previous example used a `DirectedGraph`. In a directed graph two edges can be between two vertices as is shown
between vertex `A` and `B`. The must go in opposite directions. If the graph were an instance of `UndirectedGraph`,
there would only be one edge between vertex `A` and `B`.

----
graph.getEdge("A", "B");
graph.getEdge("B", "A");
----

In an `UndirectedGraph` both calls to `getEdge` returns the same edge instance. The first call creates the edge.

== Create a graph using vertex methods

A graph can be constructed by calling `getVertex` methods. A Vertex will be returned which can then be connected to
other vertices using `connectsTo` or `connectsFrom`.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/VertexMethods.java[tag=getVertex]
----

image::images/getVertexMethods.png[]

== Visualize a graph with graphviz

Graphs can be visualized using the `graphs-graphviz` module. The module converts a graph to the `dot` language or an
image. Example:

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/EdgeMethods.java[tags=dot]
----

image::images/edgeMethods.png[edge classification]

== pre-order iterator and pre-order stream

And iterator and stream are provided to perform pre-order depth first traversals.

[source,java,indent=0]
----
include::{sourcedir}/com/github/moaxcp/graphs/manual/PreorderTraversal.java[tags=preOrderIterator]
----

image::images/preOrderTraversal.png[pre order]